{% extends "base.html" %}

{% block title %}Student Reports{% endblock %}

{% block content %}
<h2 style="margin-bottom: 30px; color: rgb(107, 0, 62);">ðŸ“¨ Student Reports - Pending Approval</h2>

<div class="card">
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Type</th>
                <th>Item Name</th>
                <th>Category</th>
                <th>Description</th>
                <th>Location</th>
                <th>Date</th>
                <th>Time</th>
                <th>Student</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for report in reports %}
            <tr>
                <td>{{ report['id'] }}</td>
                <td>
                    {% if report['report_type'] == 'lost' %}
                        <span class="badge badge-pending">Lost</span>
                    {% else %}
                        <span class="badge badge-claimed">Found</span>
                    {% endif %}
                </td>
                <td><strong>{{ report['item_name'] }}</strong></td>
                <td>{{ report['category'] }}</td>
                <td>{{ report['description'][:50] }}...</td>
                <td>{{ report['location'] }}</td>
                <td>{{ report['date_occurred'] }}</td>
                <td>{{ report['time_occurred'] or 'N/A' }}</td>
                <td>{{ report['student_name'] }}<br><small>({{ report['username'] }})</small></td>
                <td>
                    {% if report['status'] == 'pending' %}
                        <span class="badge badge-pending">Pending</span>
                    {% elif report['status'] == 'approved' %}
                        <span class="badge badge-resolved">Approved</span>
                    {% else %}
                        <span class="badge badge-danger" style="background: #dc3545;">Rejected</span>
                    {% endif %}
                </td>
                <td>
                    {% if report['status'] == 'pending' %}
                        <div style="display: flex; gap: 5px; flex-direction: column;">
                            <button onclick="approveReport({{ report['id'] }})" 
                                    class="btn btn-success" 
                                    style="padding: 5px 10px; font-size: 14px;">
                                Approve & Post
                            </button>
                            <a href="{{ url_for('reject_report', report_id=report['id']) }}" 
                               class="btn btn-danger" 
                               onclick="return confirm('Are you sure you want to reject this report?')"
                               style="padding: 5px 10px; font-size: 14px;">
                                Reject
                            </a>
                        </div>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% if not reports %}
    <p style="text-align: center; padding: 30px; color: #666;">No student reports found.</p>
    {% endif %}
</div>

<!-- Approval Modal -->
<div id="approvalModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7);">
    <div style="background: white; margin: 100px auto; padding: 30px; width: 500px; border-radius: 10px;">
        <h3 style="margin-bottom: 20px;">Approve Report & Add Photo (Optional)</h3>
        <form id="approvalForm" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label for="photo">Upload Photo (Optional)</label>
                <input type="file" id="photo" name="photo" class="form-control" accept="image/*">
                <small style="color: #666; font-size: 14px;">Add a photo of the item if available</small>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button type="submit" class="btn btn-primary">Approve & Post</button>
                <button type="button" onclick="closeApprovalModal()" class="btn btn-secondary">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
    function approveReport(reportId) {
        const modal = document.getElementById('approvalModal');
        const form = document.getElementById('approvalForm');
        form.action = `/admin/approve_report/${reportId}`;
        modal.style.display = 'block';
    }
    
    function closeApprovalModal() {
        document.getElementById('approvalModal').style.display = 'none';
    }
</script>
{% endblock %}